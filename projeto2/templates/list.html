{% extends "base.html" %}
{% block title %}Ambientes Criados — EasyExec{% endblock %}
{% block content %}

<div class="dashboard">
  <h2>🌐 Ambientes Criados</h2>
  <p class="subtitle">Gerencie execuções e visualize logs em tempo real.</p>

  <div class="table-container">
    {% if envs %}
      <table class="styled-table">
        <thead>
          <tr>
            <th>Nome</th>
            <th>CPU</th>
            <th>Memória</th>
            <th>Status</th>
            <th>Criado em</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for e in envs %}
          <tr>
            <td><strong>{{ e[1] }}</strong></td>
            <td>{{ e[2] }}</td>
            <td>{{ e[3] }}</td>
            <td>
              {% if e[4] == "executando" %}
                <span class="badge green">🟢 Em execução</span>
              {% elif e[4] == "reiniciado" %}
                <span class="badge blue">🔵 Reiniciado</span>
              {% else %}
                <span class="badge gray">⚫ Finalizado</span>
              {% endif %}
            </td>
            <td>{{ e[5] }}</td>
            <td class="actions">
              <a href="/log/{{ e[1] }}" class="btn small blue">📄 Log</a>
              <a href="/restart/{{ e[1] }}" class="btn small blue">🔁</a>
              <a href="/stop/{{ e[1] }}" class="btn small red">🛑</a>
               <form action="/delete/{{ e[1] }}" method="post" style="display:inline;" onsubmit="return confirmDelete('{{ e[1] }}')">
                <button type="submit" class="btn small" title="Deletar ambiente" style="background:#dc3545;color:white;border:none;padding:6px 8px;border-radius:5px;">
                  🗑️
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="empty">Nenhum ambiente criado ainda.</p>
    {% endif %}
  </div>

  <div class="center">
    <a href="/" class="btn primary">➕ Criar Novo Ambiente</a>
  </div>
</div>

<hr class="divider">

<h2>📊 Processos Ativos (TOP)</h2>
<p class="subtitle">Monitor de processos da VM (atualiza a cada 2s).</p>

<div id="top-container">
  <pre>Carregando processos...</pre>
</div>

<script>
async function atualizarTop() {
  try {
    const response = await fetch("/top");
    const html = await response.text();
    document.getElementById("top-container").innerHTML = html;
  } catch (e) {
    document.getElementById("top-container").innerHTML =
      "<pre>Erro ao atualizar TOP.</pre>";
  }
}
atualizarTop();
setInterval(atualizarTop, 2000);

// Função de confirmação para o botão de deletar
function confirmDelete(name) {
  return confirm(
    "Tem certeza que deseja deletar o ambiente '" +
      name +
      "'? Isso apagará logs e arquivos relacionados."
  );
}
</script>


<style>
.dashboard { padding: 20px; }
.table-container { margin-top: 10px; }
.styled-table {
  width: 100%; border-collapse: collapse; background: #fff;
  box-shadow: 0 0 10px rgba(0,0,0,0.1); border-radius: 8px;
}
.styled-table th {
  background: #0078d7; color: white; padding: 10px;
}
.styled-table td { padding: 8px; border-bottom: 1px solid #ddd; }
.styled-table tr:nth-child(even) { background: #f9f9f9; }
.badge { padding: 4px 8px; border-radius: 4px; font-weight: bold; color: white; }
.badge.green { background: #28a745; }
.badge.blue  { background: #0078d7; }
.badge.gray  { background: #6c757d; }
.actions a { margin-right: 5px; }
.btn.small { font-size: 0.9em; padding: 5px 8px; border-radius: 5px; }
.btn.red { background: #dc3545; color: white; }
.btn.blue { background: #0078d7; color: white; }
.btn.primary { background: #28a745; color: white; }
.divider { margin: 25px 0; border: none; height: 2px; background: #ccc; }
</style>

{% endblock %}
